import{a as A}from"./chunk-W4BEYFAW.js";import{a as q,b as u,c as T,d as P,e as j,g as L,h as R,l as G,n as V}from"./chunk-GCJII3IO.js";import{Ca as m,Ha as k,Na as F,Ra as v,Xb as I,_b as N,cb as c,db as o,eb as i,fb as s,jb as w,tb as l,vb as E}from"./chunk-RZNYGHVX.js";var M="basil",W=function(e){return e===3?"v3":e},O="https://js.stripe.com",X="".concat(O,"/").concat(M,"/stripe.js"),Z=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,K=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,B="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",H=function(e){return Z.test(e)||K.test(e)},Q=function(){for(var e=document.querySelectorAll('script[src^="'.concat(O,'"]')),t=0;t<e.length;t++){var r=e[t];if(H(r.src))return r}return null},D=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",r=document.createElement("script");r.src="".concat(X).concat(t);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(r),r},Y=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"7.9.0",startTime:t})},S=null,y=null,_=null,ee=function(e){return function(t){e(new Error("Failed to load Stripe.js",{cause:t}))}},te=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},re=function(e){return S!==null?S:(S=new Promise(function(t,r){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe&&e&&console.warn(B),window.Stripe){t(window.Stripe);return}try{var a=Q();if(a&&e)console.warn(B);else if(!a)a=D(e);else if(a&&_!==null&&y!==null){var d;a.removeEventListener("load",_),a.removeEventListener("error",y),(d=a.parentNode)===null||d===void 0||d.removeChild(a),a=D(e)}_=te(t,r),y=ee(r),a.addEventListener("load",_),a.addEventListener("error",y)}catch(p){r(p);return}}),S.catch(function(t){return S=null,Promise.reject(t)}))},ie=function(e,t,r){if(e===null)return null;var a=t[0],d=a.match(/^pk_test/),p=W(e.version),f=M;d&&p!==f&&console.warn("Stripe.js@".concat(p," was loaded on the page, but @stripe/stripe-js@").concat("7.9.0"," expected Stripe.js@").concat(f,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var h=e.apply(void 0,t);return Y(h,r),h},g,U=!1,z=function(){return g||(g=re(null).catch(function(e){return g=null,Promise.reject(e)}),g)};Promise.resolve().then(function(){return z()}).catch(function(n){U||console.warn(n)});var $=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];U=!0;var a=Date.now();return z().then(function(d){return ie(d,t,a)})};function ne(n,e){n&1&&(o(0,"div",27),l(1," First name is required "),i())}function oe(n,e){n&1&&(o(0,"div",27),l(1," Last name is required "),i())}function le(n,e){n&1&&(o(0,"div",27),l(1," Email is required "),i())}function ae(n,e){n&1&&(o(0,"div",27),l(1," Please enter a valid email "),i())}function me(n,e){n&1&&(o(0,"div",27),l(1," Address is required "),i())}function de(n,e){n&1&&(o(0,"div",27),l(1," City is required "),i())}function ce(n,e){n&1&&(o(0,"div",27),l(1," State is required "),i())}function se(n,e){n&1&&(o(0,"div",27),l(1," ZIP code is required "),i())}var J=class n{constructor(e,t){this.fb=e;this.cartService=t;this.checkoutForm=this.fb.group({firstName:["",u.required],lastName:["",u.required],email:["",[u.required,u.email]],address:["",u.required],city:["",u.required],state:["",u.required],zip:["",u.required]})}checkoutForm;stripe;card;processing=!1;total=0;async ngOnInit(){this.total=this.cartService.getTotal(),this.stripe=await $("your_publishable_key");let e=this.stripe.elements();this.card=e.create("card"),this.card.mount("#card-element"),this.card.addEventListener("change",t=>{let r=document.getElementById("card-errors");r&&(r.textContent=t.error?t.error.message:"")})}async onSubmit(){if(!this.checkoutForm.invalid){this.processing=!0;try{let{paymentMethod:e,error:t}=await this.stripe.createPaymentMethod({type:"card",card:this.card,billing_details:{name:`${this.checkoutForm.get("firstName")?.value} ${this.checkoutForm.get("lastName")?.value}`,email:this.checkoutForm.get("email")?.value,address:{line1:this.checkoutForm.get("address")?.value,city:this.checkoutForm.get("city")?.value,state:this.checkoutForm.get("state")?.value,postal_code:this.checkoutForm.get("zip")?.value}}});if(t)throw new Error(t.message);console.log("Payment successful:",e),this.cartService.clearCart()}catch(e){console.error("Payment failed:",e);let t=document.getElementById("card-errors");t&&(t.textContent=e.message)}this.processing=!1}}static \u0275fac=function(t){return new(t||n)(k(G),k(A))};static \u0275cmp=F({type:n,selectors:[["app-checkout"]],decls:71,vars:13,consts:[[1,"container","mt-4"],[1,"row"],[1,"col-md-8"],[1,"card"],[1,"card-body"],[1,"card-title","mb-4"],[3,"ngSubmit","formGroup"],[1,"col-md-6","mb-3"],[1,"form-label"],["type","text","formControlName","firstName",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["type","text","formControlName","lastName",1,"form-control"],[1,"mb-3"],["type","email","formControlName","email",1,"form-control"],["type","text","formControlName","address",1,"form-control"],["type","text","formControlName","city",1,"form-control"],[1,"col-md-3","mb-3"],["type","text","formControlName","state",1,"form-control"],["type","text","formControlName","zip",1,"form-control"],["id","card-element",1,"form-control"],["id","card-errors",1,"invalid-feedback"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"col-md-4"],[1,"card-title"],[1,"d-flex","justify-content-between","mb-3"],[1,"d-flex","justify-content-between"],[1,"fw-bold"],[1,"invalid-feedback"]],template:function(t,r){if(t&1&&(o(0,"div",0)(1,"h2"),l(2,"Checkout"),i(),o(3,"div",1)(4,"div",2)(5,"div",3)(6,"div",4)(7,"h5",5),l(8,"Billing Details"),i(),o(9,"form",6),w("ngSubmit",function(){return r.onSubmit()}),o(10,"div",1)(11,"div",7)(12,"label",8),l(13,"First Name"),i(),s(14,"input",9),v(15,ne,2,0,"div",10),i(),o(16,"div",7)(17,"label",8),l(18,"Last Name"),i(),s(19,"input",11),v(20,oe,2,0,"div",10),i()(),o(21,"div",12)(22,"label",8),l(23,"Email"),i(),s(24,"input",13),v(25,le,2,0,"div",10)(26,ae,2,0,"div",10),i(),o(27,"div",12)(28,"label",8),l(29,"Address"),i(),s(30,"input",14),v(31,me,2,0,"div",10),i(),o(32,"div",1)(33,"div",7)(34,"label",8),l(35,"City"),i(),s(36,"input",15),v(37,de,2,0,"div",10),i(),o(38,"div",16)(39,"label",8),l(40,"State"),i(),s(41,"input",17),v(42,ce,2,0,"div",10),i(),o(43,"div",16)(44,"label",8),l(45,"ZIP Code"),i(),s(46,"input",18),v(47,se,2,0,"div",10),i()(),o(48,"div",12)(49,"label",8),l(50,"Card Information"),i(),s(51,"div",19)(52,"div",20),i(),o(53,"button",21),l(54),i()()()()(),o(55,"div",22)(56,"div",3)(57,"div",4)(58,"h5",23),l(59,"Order Summary"),i(),o(60,"div",24)(61,"span"),l(62,"Subtotal"),i(),o(63,"span"),l(64),i()(),s(65,"hr"),o(66,"div",25)(67,"span",26),l(68,"Total"),i(),o(69,"span",26),l(70),i()()()()()()()),t&2){let a,d,p,f,h,C,b,x;m(9),c("formGroup",r.checkoutForm),m(6),c("ngIf",(a=r.checkoutForm.get("firstName"))==null||a.errors==null?null:a.errors.required),m(5),c("ngIf",(d=r.checkoutForm.get("lastName"))==null||d.errors==null?null:d.errors.required),m(5),c("ngIf",(p=r.checkoutForm.get("email"))==null||p.errors==null?null:p.errors.required),m(),c("ngIf",(f=r.checkoutForm.get("email"))==null||f.errors==null?null:f.errors.email),m(5),c("ngIf",(h=r.checkoutForm.get("address"))==null||h.errors==null?null:h.errors.required),m(6),c("ngIf",(C=r.checkoutForm.get("city"))==null||C.errors==null?null:C.errors.required),m(5),c("ngIf",(b=r.checkoutForm.get("state"))==null||b.errors==null?null:b.errors.required),m(5),c("ngIf",(x=r.checkoutForm.get("zip"))==null||x.errors==null?null:x.errors.required),m(6),c("disabled",r.checkoutForm.invalid||r.processing),m(),E(" ",r.processing?"Processing...":"Place Order"," "),m(10),E("$",r.total.toFixed(2)),m(6),E("$",r.total.toFixed(2))}},dependencies:[N,I,V,j,q,T,P,L,R],encapsulation:2})};export{J as CheckoutComponent};
